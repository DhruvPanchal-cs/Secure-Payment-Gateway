<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Transactions - Merchant</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">
  <div class="max-w-7xl mx-auto mt-8 px-4">
    <div class="flex justify-between items-center mb-4">
      <h1 class="text-2xl font-semibold">Transactions</h1>
      <a href="{{ url_for('merchant_dashboard') }}" class="px-3 py-2 bg-gray-200 rounded">Back to Dashboard</a>
    </div>

    <form method="get" class="flex gap-3 mb-4">
      <input type="text" name="q" placeholder="search id / name / desc" value="{{ q or '' }}" class="px-3 py-2 border rounded flex-1">
      <select name="status" class="px-3 py-2 border rounded">
        <option value="all" {% if status_filter in [None, 'all'] %}selected{% endif %}>All</option>
        <option value="success" {% if status_filter == 'success' %}selected{% endif %}>Success</option>
        <option value="failed" {% if status_filter == 'failed' %}selected{% endif %}>Failed</option>
        <option value="refunded" {% if status_filter == 'refunded' %}selected{% endif %}>Refunded</option>
        <option value="voided" {% if status_filter == 'voided' %}selected{% endif %}>Voided</option>
      </select>
      <button class="px-4 py-2 bg-indigo-600 text-white rounded">Filter</button>
    </form>

    <div class="bg-white shadow rounded overflow-hidden">
      <table class="min-w-full text-sm">
        <thead class="bg-gray-100 text-left">
          <tr>
            <th class="p-3">ID</th>
            <th class="p-3">Timestamp</th>
            <th class="p-3">Amount</th>
            <th class="p-3">Status</th>
            <th class="p-3">Customer</th>
            <th class="p-3">Description</th>
          </tr>
        </thead>
        <tbody>
          {% for t in txns %}
            <tr class="border-b hover:bg-gray-50">
              <td class="p-3 font-mono text-xs">{{ t.id }}</td>
              <td class="p-3">{{ t.timestamp }}</td>
              <td class="p-3">{{ '{:.2f}'.format(t.amount) }} {{ t.currency }}</td>
              <td class="p-3">{{ t.status }}</td>
              <td class="p-3">{{ t.customer_name or 'N/A' }}</td>
              <td class="p-3">{{ t.purchase_description or '' }}</td>
            </tr>
          {% else %}
            <tr>
              <td colspan="6" class="p-6 text-center text-gray-500">No transactions found.</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      <div class="p-4 flex justify-between items-center bg-gray-50">
        <div>Page {{ pagination.page }} of {{ pagination.pages or 1 }}</div>
        <div class="flex gap-2">
          {% if pagination.has_prev %}
            <a href="{{ url_for('merchant_transactions', page=1, per_page=per_page, q=q, status=status_filter) }}" class="px-3 py-1 bg-gray-200 rounded">First</a>
            <a href="{{ url_for('merchant_transactions', page=pagination.prev_num, per_page=per_page, q=q, status=status_filter) }}" class="px-3 py-1 bg-gray-200 rounded">Prev</a>
          {% endif %}
          <span class="px-3 py-1 bg-blue-600 text-white rounded">{{ pagination.page }}</span>
          {% if pagination.has_next %}
            <a href="{{ url_for('merchant_transactions', page=pagination.next_num, per_page=per_page, q=q, status=status_filter) }}" class="px-3 py-1 bg-gray-200 rounded">Next</a>
            <a href="{{ url_for('merchant_transactions', page=pagination.pages, per_page=per_page, q=q, status=status_filter) }}" class="px-3 py-1 bg-gray-200 rounded">Last</a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</body>
</html>
